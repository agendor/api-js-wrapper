/*! agendor-wrapper 03-09-2014 */
(function(){"use strict";function a(a,b){b({error:a})}function b(a){var b=null;if(void 0!==typeof XMLHttpRequest)b=new XMLHttpRequest;else if(window.ActiveXObject)for(var c=["MSXML2.XMLHttp.6.0","MSXML2.XMLHttp.5.0","MSXML2.XMLHttp.4.0","MSXML2.XMLHttp.3.0","MSXML2.XMLHttp","Microsoft.XMLHttp"],d=0;d<c.length;d++)try{b=new ActiveXObject(c[d])}catch(g){}var h=e.AGENDOR_API_URL.concat(a);return b.open("post",h,!0),b.setRequestHeader("Content-Type","application/json"),b.setRequestHeader("Authorization","Token "+f.token),b}var c=this,d=c.agendor,e={AGENDOR_API_URL:"http://localhost:8000",PERSON_ROUTE:"/people",ORGANIZATION_ROUTE:"/organizations",DEAL_ROUTE:"/deals"},f=function(){this.token=null};f.noConflict=function(){return c.agendor=d,f},f.setToken=function(a){this.token=a},f.deal={add:function(c,d){function f(){var c=b(e.DEAL_ROUTE);c.onreadystatechange=function(){if(4===c.readyState)if(201===c.status){var b=JSON.parse(c.responseText);h&&(b.person=h),i&&(b.organization=i),d(b)}else a(JSON.parse(c.responseText,d))},c.send(JSON.stringify(g))}var g=JSON.parse(JSON.stringify(c)),h=c.person,i=c.organization;if(h&&!i){var j=b(e.PERSON_ROUTE);j.onreadystatechange=function(){if(4===j.readyState)if(201===j.status)h=JSON.parse(j.responseText),g.person=h.personId,f();else{var a=JSON.parse(j.responseText);d({error:a})}},j.send(JSON.stringify(h))}else if(!h&&i){var k=b(e.ORGANIZATION_ROUTE);k.onreadystatechange=function(){4===k.readyState&&(201===k.status?(i=JSON.parse(k.responseText),g.organization=i.organizationId,f()):a(JSON.parse(k.responseText,d)))},k.send(JSON.stringify(i))}else if(h&&i){var l=b(e.PERSON_ROUTE);l.onreadystatechange=function(){if(4===l.readyState)if(201===l.status){h=JSON.parse(l.responseText),g.person=h.personId;var c=b(e.ORGANIZATION_ROUTE);c.onreadystatechange=function(){4===c.readyState&&(201===c.status?(i=JSON.parse(c.responseText),g.organization=i.organizationId,f()):a(JSON.parse(c.responseText,d)))},c.send(JSON.stringify(i))}else a(JSON.parse(l.responseText,d))},l.send(JSON.stringify(h))}else h||i||f()}},c.agendor=f}).call(this);