/*! agendor-wrapper 01-09-2014 */
(function(){"use strict";function a(a){var b="https://api.agendor.com.br/v1",c=d.token,e=null;if(void 0!==typeof XMLHttpRequest)e=new XMLHttpRequest;else if(window.ActiveXObject)for(var f=["MSXML2.XMLHttp.6.0","MSXML2.XMLHttp.5.0","MSXML2.XMLHttp.4.0","MSXML2.XMLHttp.3.0","MSXML2.XMLHttp","Microsoft.XMLHttp"],g=0;g<f.length;g++)try{e=new ActiveXObject(f[g])}catch(h){}var i=b.concat(a);return e.open("post",i,!0),e.setRequestHeader("Content-Type","application/json"),e.setRequestHeader("Authorization","Token "+c),e}var b=this,c=b.agendor,d=function(){this.token=null};d.noConflict=function(){return b.agendor=c,d},d.setToken=function(a){this.token=a},d.deal={add:function(b,c){function d(c,d){h&&(b.person=c,h.personId=c),i&&(b.organization=c,i.organizationId=c);var j=a("/deals");j.onreadystatechange=function(){if(4===j.readyState){if(201!==j.status){var a=JSON.parse(j.responseText);throw a.message}e=JSON.parse(j.responseText),h&&(e.person=f),i&&(e.organization=g),d(e)}},j.send(JSON.stringify(b)),b.person=h,b.organization=i}var e,f,g,h=b.person,i=b.organization;if(h){var j=a("/people");j.onreadystatechange=function(){if(4===j.readyState){if(201!==j.status){var a=JSON.parse(j.responseText);throw a.message}f=JSON.parse(j.responseText),d(f.personId,c)}},j.send(JSON.stringify(h))}else{if(!i)throw"ERROR: A person or organization is required to insert a deal";var k=a("/organizations");k.onreadystatechange=function(){if(4===k.readyState){if(201!==k.status){var a=JSON.parse(k.responseText);throw a.message}g=JSON.parse(k.responseText),d(g.organizationId,c)}},k.send(JSON.stringify(i))}}},b.agendor=d}).call(this);