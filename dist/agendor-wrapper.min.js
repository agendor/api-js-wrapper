/*! agendor-wrapper 27-08-2014 */
(function(){"use strict";var a=this,b=a.agendor,c=function(){this.token=null};c.noConflict=function(){return a.agendor=b,c},c.setToken=function(a){this.token=a},c.addDeal=function(a,b){var c=this,d=a.person,e=a.organization,f=function(a,b){var c="http://localhost:8000",d=null;if(void 0!==typeof XMLHttpRequest)d=new XMLHttpRequest;else if(window.ActiveXObject)for(var e=["MSXML2.XMLHttp.6.0","MSXML2.XMLHttp.5.0","MSXML2.XMLHttp.4.0","MSXML2.XMLHttp.3.0","MSXML2.XMLHttp","Microsoft.XMLHttp"],f=0;f<e.length;f++)try{d=new ActiveXObject(e[f])}catch(g){}var h=c.concat(a);return d.open("post",h,!0),d.setRequestHeader("Content-Type","application/json"),d.setRequestHeader("Authorization","Basic "+b),d},g=function(b,g){d&&(a.person=b,d.personId=b),e&&(a.organization=b,e.organizationId=b);var h=f("/deals",c.token);h.onreadystatechange=function(){if(4===h.readyState){if(201!==h.status){var b=JSON.parse(h.responseText);throw b.message}a=JSON.parse(h.responseText),d&&(a.person=d),e&&(a.organization=e),g(a)}},h.send(JSON.stringify(a))};if(d){var h=f("/people",c.token);h.onreadystatechange=function(){if(4===h.readyState){if(201!==h.status){var a=JSON.parse(h.responseText);throw a.message}d=JSON.parse(h.responseText),g(d.personId,b)}},h.send(JSON.stringify(d))}else{if(!e)throw"ERROR: A person or organization is required to insert a deal";var i=f("/organizations",c.token);i.onreadystatechange=function(){if(4===i.readyState){if(201!==i.status){var a=JSON.parse(i.responseText);throw a.message}e=JSON.parse(i.responseText),g(e.organizationId,b)}},i.send(JSON.stringify(e))}},a.agendor=c}).call(this);