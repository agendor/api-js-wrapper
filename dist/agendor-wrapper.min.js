/*! agendor-wrapper 30-08-2014 */
(function(){"use strict";function a(a){var b="https://api.agendor.com.br/v1",c=d.token,e=null;if(void 0!==typeof XMLHttpRequest)e=new XMLHttpRequest;else if(window.ActiveXObject)for(var f=["MSXML2.XMLHttp.6.0","MSXML2.XMLHttp.5.0","MSXML2.XMLHttp.4.0","MSXML2.XMLHttp.3.0","MSXML2.XMLHttp","Microsoft.XMLHttp"],g=0;g<f.length;g++)try{e=new ActiveXObject(f[g])}catch(h){}var i=b.concat(a);return e.open("post",i,!0),e.setRequestHeader("Content-Type","application/json"),e.setRequestHeader("Authorization","Token "+c),e}var b=this,c=b.agendor,d=function(){this.token=null};d.noConflict=function(){return b.agendor=c,d},d.setToken=function(a){this.token=a},d.deal={add:function(b,c){function d(c,d){e&&(b.person=c,e.personId=c),f&&(b.organization=c,f.organizationId=c);var g=a("/deals");g.onreadystatechange=function(){if(4===g.readyState){if(201!==g.status){var a=JSON.parse(g.responseText);throw a.message}b=JSON.parse(g.responseText),e&&(b.person=e),f&&(b.organization=f),d(b)}},g.send(JSON.stringify(b))}var e=b.person,f=b.organization;if(e){var g=a("/people");g.onreadystatechange=function(){if(4===g.readyState){if(201!==g.status){var a=JSON.parse(g.responseText);throw a.message}e=JSON.parse(g.responseText),d(e.personId,c)}},g.send(JSON.stringify(e))}else{if(!f)throw"ERROR: A person or organization is required to insert a deal";var h=a("/organizations");h.onreadystatechange=function(){if(4===h.readyState){if(201!==h.status){var a=JSON.parse(h.responseText);throw a.message}f=JSON.parse(h.responseText),d(f.organizationId,c)}},h.send(JSON.stringify(f))}}},b.agendor=d}).call(this);