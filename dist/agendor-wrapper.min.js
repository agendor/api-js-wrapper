/*! agendor-wrapper 17-09-2014 */
(function(){"use strict";function a(a,b){b({error:a})}function b(a){var b=null;if(void 0!==typeof XMLHttpRequest)b=new XMLHttpRequest;else if(window.ActiveXObject)for(var c=["MSXML2.XMLHttp.6.0","MSXML2.XMLHttp.5.0","MSXML2.XMLHttp.4.0","MSXML2.XMLHttp.3.0","MSXML2.XMLHttp","Microsoft.XMLHttp"],d=0;d<c.length;d++)try{b=new ActiveXObject(c[d])}catch(g){}var h=e.AGENDOR_API_URL.concat(a);return b.open("post",h,!0),b.setRequestHeader("Content-Type","application/json"),b.setRequestHeader("Authorization","Token "+f.token),b}var c=this,d=c.agendor,e={AGENDOR_API_URL:"https://api.agendor.com.br/v1",PERSON_ROUTE:"/people",ORGANIZATION_ROUTE:"/organizations",DEAL_ROUTE:"/deals",TASK_ROUTE:"/tasks"},f=function(){this.token=null};f.noConflict=function(){return c.agendor=d,f},f.setToken=function(a){this.token=a},f.person={add:function(c,d){var f=b(e.PERSON_ROUTE);f.onreadystatechange=function(){if(4===f.readyState)if(201===f.status){var b=JSON.parse(f.responseText);d(b)}else a(JSON.parse(f.responseText),d)},f.send(JSON.stringify(c))}},f.deal={add:function(c,d){function g(){h.dealStageOrder=1;var c=b(e.DEAL_ROUTE);c.onreadystatechange=function(){if(4===c.readyState)if(201===c.status){var b=JSON.parse(c.responseText);b.person=j,d(b)}else a(JSON.parse(c.responseText,d))},c.send(JSON.stringify(h))}var h=JSON.parse(JSON.stringify(c)),i=c.person,j=null;i?f.person.add(i,function(b){b.error?a(b.error,d):(j=JSON.parse(JSON.stringify(b)),h.person=b.personId,g())}):g()}},f.task={add:function(c,d){var g=JSON.parse(JSON.stringify(c)),h=c.deal,i=null;f.deal.add(h,function(c){if(c.error)a(c.error,d);else{i=JSON.parse(JSON.stringify(c)),g.deal=c.dealId;var f=b(e.TASK_ROUTE);f.onreadystatechange=function(){if(4===f.readyState)if(201===f.status){var b=JSON.parse(f.responseText);b.deal=i,d(b)}else a(JSON.parse(f.responseText,d))},f.send(JSON.stringify(g))}})}},c.agendor=f}).call(this);